<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">





  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "e32cdd0f"
    });
  daovoice('update');
  </script>















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/favicon-32x32-next.png?v=5.1.4" color="#222">





  <meta name="keywords" content="android,心率检测,">










<meta name="description" content="Android之——模拟实现检测心率变化的应用实例当今，市面上有了一些可以通过Android应用来检测病人心率，血压，体温，等等，一系列方便人们日常生活的Android手机应用。那么，这些实用的手机应用程序是怎么做出来的呢？那么，今天，我就给大家奉上一个很有意思的应用，那就是Android上模拟实现检测心率的变化。我利用Android模拟实现了通过手机摄像头来感知用户指尖毛细血管的变化来检测心率的">
<meta name="keywords" content="android,心率检测">
<meta property="og:type" content="article">
<meta property="og:title" content="Android之——模拟实现检测心率变化的应用实例">
<meta property="og:url" content="http://www.mashangxue123.com/2018/07/28/Android之——模拟实现检测心率变化的应用实例/index.html">
<meta property="og:site_name" content="DmrfCoder&#39;s page">
<meta property="og:description" content="Android之——模拟实现检测心率变化的应用实例当今，市面上有了一些可以通过Android应用来检测病人心率，血压，体温，等等，一系列方便人们日常生活的Android手机应用。那么，这些实用的手机应用程序是怎么做出来的呢？那么，今天，我就给大家奉上一个很有意思的应用，那就是Android上模拟实现检测心率的变化。我利用Android模拟实现了通过手机摄像头来感知用户指尖毛细血管的变化来检测心率的">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://img-
blog.csdn.net/20150731150731132?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:image" content="https://img-
blog.csdn.net/20150731150909022?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:image" content="https://img-
blog.csdn.net/20150731151115964?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:image" content="https://img-
blog.csdn.net/20150731151054385?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:image" content="https://img-
blog.csdn.net/20150731151739678?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:updated_time" content="2018-12-05T14:39:29.731Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android之——模拟实现检测心率变化的应用实例">
<meta name="twitter:description" content="Android之——模拟实现检测心率变化的应用实例当今，市面上有了一些可以通过Android应用来检测病人心率，血压，体温，等等，一系列方便人们日常生活的Android手机应用。那么，这些实用的手机应用程序是怎么做出来的呢？那么，今天，我就给大家奉上一个很有意思的应用，那就是Android上模拟实现检测心率的变化。我利用Android模拟实现了通过手机摄像头来感知用户指尖毛细血管的变化来检测心率的">
<meta name="twitter:image" content="https://img-
blog.csdn.net/20150731150731132?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.mashangxue123.com/2018/07/28/Android之——模拟实现检测心率变化的应用实例/">





  <title>Android之——模拟实现检测心率变化的应用实例 | DmrfCoder's page</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-130602831-1', 'auto');
  ga('send', 'pageview');
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->





</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

	<a href="https://github.com/DmrfCoder">
		<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub">
	</a>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">DmrfCoder's page</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-moments">
          <a href="/news/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-fal fa-calendar"></i> <br>
            
            Moments
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/user/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About me
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.mashangxue123.com/2018/07/28/Android之——模拟实现检测心率变化的应用实例/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="DmrfCoder">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DmrfCoder's page">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Android之——模拟实现检测心率变化的应用实例</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-28T13:44:54+08:00">
                2018-07-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/07/28/Android之——模拟实现检测心率变化的应用实例/" class="leancloud_visitors" data-flag-title="Android之——模拟实现检测心率变化的应用实例">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  7.5k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  37
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Android之——模拟实现检测心率变化的应用实例"><a href="#Android之——模拟实现检测心率变化的应用实例" class="headerlink" title="Android之——模拟实现检测心率变化的应用实例"></a>Android之——模拟实现检测心率变化的应用实例</h1><p>当今，市面上有了一些可以通过Android应用来检测病人心率，血压，体温，等等，一系列方便人们日常生活的Android手机应用。那么，这些实用的手机应用程序是怎么做出来的呢？那么，今天，我就给大家奉上一个很有意思的应用，那就是Android上模拟实现检测心率的变化。我利用Android模拟实现了通过手机摄像头来感知用户指尖毛细血管的变化来检测心率的功能。哇哦，听起来是不是很高大上呢？瞬间对这个功能充满了膜拜与好奇，有木有？！有木有呢？！哈哈，那就让我们一起来实现这些功能吧。</p>
<h3 id="一、原理"><a href="#一、原理" class="headerlink" title="一、原理"></a>一、原理</h3><p>首先我们还是要讲讲这个应用的原理吧，在下认为，要做一个Android应用程序，咱们还要先弄懂它的实现原理吧。不然，看了半天各位都不知道这个应用是基于什么原理做的呢。是吧，那就让我们一起来分析下它的实现原理。</p>
<p>通过摄像头来获得心率，搜了一下这个技术真不是噱头，据说在iPhone早有实现，主要原理是：当打开软件时，手机的闪光灯也会被自动打开，用户将手指放在摄像头上时，指尖皮下血管由于有血液被压入，被光源照射的手指亮度（红色的深度）会有轻微的变化。这个过程可以凭借感光元件捕捉到。这样毛细血管的搏动就能通过画面明度的周期性变化反映出来。</p>
<p>好了，原理说完了，大家有木有看懂呢？</p>
<h3 id="二、实现"><a href="#二、实现" class="headerlink" title="二、实现"></a>二、实现</h3><h4 id="1、创建图像处理类ImageProcessing"><a href="#1、创建图像处理类ImageProcessing" class="headerlink" title="1、创建图像处理类ImageProcessing"></a>1、创建图像处理类ImageProcessing</h4><p>这个类主要提供处理图像本身的方法。</p>
<p>具体实现如下：</p>
<pre><code>      1. package com.lyz.monitor.utils;

  2.  

  3. /**

  4.  * 图像处理类

  5.  * @author liuyazhuang

  6.  *

  7.  */

  8. public abstract class ImageProcessing {

  9.  

  10.    /**

  11.    * 内部调用的处理图片的方法

  12.     * @param yuv420sp

  13.     * @param width

  14.    * @param height

  15.   * @return

  16.     */

  17.   private static int decodeYUV420SPtoRedSum(byte[] yuv420sp, int width,int height) {

  18.       if (yuv420sp == null)

  19.            return 0;

  20.         final int frameSize = width * height;

  21.        int sum = 0;

  22.      for (int j = 0, yp = 0; j &lt; height; j++) {

  23.          int uvp = frameSize + (j &gt;&gt; 1) * width, u = 0, v = 0;

  24.             for (int i = 0; i &lt; width; i++, yp++) {

  25.              int y = (0xff &amp; ((int) yuv420sp[yp])) - 16;

  26.                if (y &lt; 0)

  27.                     y = 0;

  28.              if ((i &amp; 1) == 0) {

  29.                  v = (0xff &amp; yuv420sp[uvp++]) - 128;

  30.                    u = (0xff &amp; yuv420sp[uvp++]) - 128;

  31.                }

  32.                int y1192 = 1192 * y;

  33.                 int r = (y1192 + 1634 * v);

  34.               int g = (y1192 - 833 * v - 400 * u);

  35.                 int b = (y1192 + 2066 * u);

  36.  

  37.              if (r &lt; 0)

  38.                     r = 0;

  39.              else if (r &gt; 262143)

  40.                     r = 262143;

  41.                 if (g &lt; 0)

  42.                     g = 0;

  43.              else if (g &gt; 262143)

  44.                     g = 262143;

  45.                 if (b &lt; 0)

  46.                     b = 0;

  47.              else if (b &gt; 262143)

  48.                     b = 262143;

  49.  

  50.                int pixel = 0xff000000 | ((r &lt;&lt; 6) &amp; 0xff0000)

  51.                        | ((g &gt;&gt; 2) &amp; 0xff00) | ((b &gt;&gt; 10) &amp; 0xff);

  52.              int red = (pixel &gt;&gt; 16) &amp; 0xff;

  53.                sum += red;

  54.          }

  55.        }

  56.        return sum;

  57.    }

  58.  

  59.   /**

  60.    * 对外开放的图像处理方法

  61.      * @param yuv420sp

  62.     * @param width

  63.    * @param height

  64.   * @return

  65.     */

  66.   public static int decodeYUV420SPtoRedAvg(byte[] yuv420sp, int width,

  67.           int height) {

  68.      if (yuv420sp == null)

  69.            return 0;

  70.         final int frameSize = width * height;

  71.        int sum = decodeYUV420SPtoRedSum(yuv420sp, width, height);

  72.         return (sum / frameSize);

  73.  }

  74. }
</code></pre><h4 id="2、MainActivity实现"><a href="#2、MainActivity实现" class="headerlink" title="2、MainActivity实现"></a>2、MainActivity实现</h4><p>为了简单，我没有单独新建别的类来分解这些功能，我直接在MainActivity中实现了这些功能，那么我们就一起来看看是如何一步步实现的吧。</p>
<h5 id="1-程序中用到的属性"><a href="#1-程序中用到的属性" class="headerlink" title="(1)程序中用到的属性"></a>(1)程序中用到的属性</h5><p>首先，我们来看看程序中定义了哪些属性字段，来实现这些功能吧。</p>
<p>具体属性字段如下所示：</p>
<pre><code>      1. //曲线

  2. private Timer timer = new Timer();

  3. //Timer任务，与Timer配套使用

  4. private TimerTask task;

  5. private static int gx;

  6. private static int j;

  7.  

  8. private static double flag=1;

  9. private Handler handler;

  10. private String title = &quot;pulse&quot;;

  11. private XYSeries series;

  12. private XYMultipleSeriesDataset mDataset;

  13. private GraphicalView chart;

  14. private XYMultipleSeriesRenderer renderer;

  15. private Context context;

  16. private int addX = -1;

  17. double addY;

  18. int[] xv = new int[300];

  19. int[] yv = new int[300];

  20. int[] hua=new int[]{9,10,11,12,13,14,13,12,11,10,9,8,7,6,7,8,9,10,11,10,10};

  21.  

  22. // private static final String TAG = &quot;HeartRateMonitor&quot;;

  23. private static final AtomicBoolean processing = new AtomicBoolean(false);

  24. //Android手机预览控件

  25. private static SurfaceView preview = null;

  26. //预览设置信息

  27. private static SurfaceHolder previewHolder = null;

  28. //Android手机相机句柄

  29. private static Camera camera = null;

  30. //private static View image = null;

  31. private static TextView text = null;

  32. private static TextView text1 = null;

  33. private static TextView text2 = null;

  34. private static WakeLock wakeLock = null;

  35. private static int averageIndex = 0;

  36. private static final int averageArraySize = 4;

  37. private static final int[] averageArray = new int[averageArraySize];

  38. //设置默认类型

  39. private static TYPE currentType = TYPE.GREEN;

  40. //获取当前类型

  41. public static TYPE getCurrent() {

  42.     return currentType;

  43. }

  44. //心跳下标值

  45. private static int beatsIndex = 0;

  46. //心跳数组的大小

  47. private static final int beatsArraySize = 3;

  48. //心跳数组

  49. private static final int[] beatsArray = new int[beatsArraySize];

  50. //心跳脉冲

  51. private static double beats = 0;

  52. //开始时间

  53. private static long startTime = 0;
</code></pre><p>咋一看，是不是很多？有木有一种头晕乎乎的赶脚呢？没关系，通过后面具体的功能实现，相信大家能弄明白每个属性字段的作用与含义的。不要掉队，继续认真向下看哦。</p>
<h5 id="2-定义枚举类型来标识当前颜色"><a href="#2-定义枚举类型来标识当前颜色" class="headerlink" title="(2)定义枚举类型来标识当前颜色"></a>(2)定义枚举类型来标识当前颜色</h5><p>颜色类型，我在这里用一个枚举类型来定义，这个枚举类型很简单，只有两种颜色，一种是绿色，一种是红色。默认颜色为绿色。</p>
<p>具体实现的代码如下:</p>
<pre><code>      1. /**

  2.      * 类型枚举

  3.      * @author liuyazhuang

  4.      *

  5.   */

  6.    public static enum TYPE {

  7.       GREEN, RED

  8.    };

  9.    //设置默认类型

  10.   private static TYPE currentType = TYPE.GREEN;

  11.    //获取当前类型

  12.   public static TYPE getCurrent() {

  13.        return currentType;

  14.    }
</code></pre><h5 id="3-初始化配置方法initConfig"><a href="#3-初始化配置方法initConfig" class="headerlink" title="(3)初始化配置方法initConfig"></a>(3)初始化配置方法initConfig</h5><p>这个方法总体上的功能是初始化程序的各个配置，包括调用其他方法，例如页面图表的初始化，UI控件的初始化，应用程序启动后显示的样式，调用相机，通过Handler接收其他方法传递过来的消息信息来更新UI，，等等。主要是实现应用的配置功能，同时这个方法相当于一个应用程序的管家，它来直接或间接的调用其他方法，来使整个应用程序顺利运行起来。</p>
<p>具体代码实现如下:</p>
<pre><code>      1. /**

  2.      * 初始化配置

  3.     */

  4.    private void initConfig() {

  5.       //曲线

  6.        context = getApplicationContext();

  7.  

  8.        //这里获得main界面上的布局，下面会把图表画在这个布局里面

  9.         LinearLayout layout = (LinearLayout)findViewById(R.id.linearLayout1);

  10.  

  11.       //这个类用来放置曲线上的所有点，是一个点的集合，根据这些点画出曲线

  12.         series = new XYSeries(title);

  13.  

  14.         //创建一个数据集的实例，这个数据集将被用来创建图表

  15.         mDataset = new XYMultipleSeriesDataset();

  16.  

  17.         //将点集添加到这个数据集中

  18.         mDataset.addSeries(series);

  19.  

  20.         //以下都是曲线的样式和属性等等的设置，renderer相当于一个用来给图表做渲染的句柄

  21.       int color = Color.GREEN;

  22.       PointStyle style = PointStyle.CIRCLE;

  23.        renderer = buildRenderer(color, style, true);

  24.  

  25.         //设置好图表的样式

  26.         setChartSettings(renderer, &quot;X&quot;, &quot;Y&quot;, 0, 300, 4, 16, Color.WHITE, Color.WHITE);

  27.  

  28.        //生成图表

  29.         chart = ChartFactory.getLineChartView(context, mDataset, renderer);

  30.  

  31.         //将图表添加到布局中去

  32.       layout.addView(chart, new LayoutParams(LayoutParams.FILL_PARENT, LayoutParams.FILL_PARENT));

  33.  

  34.      //这里的Handler实例将配合下面的Timer实例，完成定时更新图表的功能

  35.        handler = new Handler() {

  36.          @Override

  37.             public void handleMessage(Message msg) {

  38.                 //               刷新图表

  39.              updateChart();

  40.               super.handleMessage(msg);

  41.          }

  42.        };

  43.  

  44.      task = new TimerTask() {

  45.           @Override

  46.             public void run() {

  47.              Message message = new Message();

  48.               message.what = 1;

  49.               handler.sendMessage(message);

  50.            }

  51.        };

  52.  

  53.      timer.schedule(task, 1,20);           //曲线

  54.       //获取SurfaceView控件

  55.      preview = (SurfaceView) findViewById(R.id.preview);

  56.      previewHolder = preview.getHolder();

  57.         previewHolder.addCallback(surfaceCallback);

  58.      previewHolder.setType(SurfaceHolder.SURFACE_TYPE_PUSH_BUFFERS);

  59.      //       image = findViewById(R.id.image);

  60.         text = (TextView) findViewById(R.id.text);

  61.       text1 = (TextView) findViewById(R.id.text1);

  62.         text2 = (TextView) findViewById(R.id.text2);

  63.         PowerManager pm = (PowerManager) getSystemService(Context.POWER_SERVICE);

  64.        wakeLock = pm.newWakeLock(PowerManager.FULL_WAKE_LOCK, &quot;DoNotDimScreen&quot;);

  65.   }
</code></pre><h5 id="4-创建图表的方法buildRenderer"><a href="#4-创建图表的方法buildRenderer" class="headerlink" title="(4)创建图表的方法buildRenderer"></a>(4)创建图表的方法buildRenderer</h5><p>这个方法主要是利用了第三方的类库类实现创建图标的操作。</p>
<p>具体代码实现如下</p>
<pre><code>      1. /**

  2.      * 创建图表

  3.      * @param color

  4.     * @param style

  5.     * @param fill

  6.      * @return

  7.      */

  8.    protected XYMultipleSeriesRenderer buildRenderer(int color, PointStyle style, boolean fill) {

  9.       XYMultipleSeriesRenderer renderer = new XYMultipleSeriesRenderer();

  10.  

  11.       //设置图表中曲线本身的样式，包括颜色、点的大小以及线的粗细等

  12.        XYSeriesRenderer r = new XYSeriesRenderer();

  13.       r.setColor(Color.RED);

  14. //     r.setPointStyle(null);

  15. //      r.setFillPoints(fill);

  16.        r.setLineWidth(1);

  17.      renderer.addSeriesRenderer(r);

  18.       return renderer;

  19.   }
</code></pre><h5 id="5-设置图表的样式方法setChartSettings"><a href="#5-设置图表的样式方法setChartSettings" class="headerlink" title="(5)设置图表的样式方法setChartSettings"></a>(5)设置图表的样式方法setChartSettings</h5><p>这个方法主要是对(4)中创建的图表，进行样式的设置。</p>
<p>具体代码如下：</p>
<pre><code>      1. /**

  2.      * 设置图标的样式

  3.   * @param renderer

  4.      * @param xTitle：x标题

  5.    * @param yTitle：y标题

  6.    * @param xMin：x最小长度

  7.    * @param xMax：x最大长度

  8.    * @param yMin:y最小长度

  9.    * @param yMax：y最大长度

  10.   * @param axesColor：颜色

  11.     * @param labelsColor：标签

  12.   */

  13.   protected void setChartSettings(XYMultipleSeriesRenderer renderer, String xTitle, String yTitle,

  14.             double xMin, double xMax, double yMin, double yMax, int axesColor, int labelsColor) {

  15.        //有关对图表的渲染可参看api文档

  16.         renderer.setChartTitle(title);

  17.       renderer.setXTitle(xTitle);

  18.      renderer.setYTitle(yTitle);

  19.      renderer.setXAxisMin(xMin);

  20.      renderer.setXAxisMax(xMax);

  21.      renderer.setYAxisMin(yMin);

  22.      renderer.setYAxisMax(yMax);

  23.      renderer.setAxesColor(axesColor);

  24.        renderer.setLabelsColor(labelsColor);

  25.        renderer.setShowGrid(true);

  26.        renderer.setGridColor(Color.GREEN);

  27.      renderer.setXLabels(20);

  28.        renderer.setYLabels(10);

  29.        renderer.setXTitle(&quot;Time&quot;);

  30.         renderer.setYTitle(&quot;mmHg&quot;);

  31.         renderer.setYLabelsAlign(Align.RIGHT);

  32.       renderer.setPointSize((float) 3 );

  33.        renderer.setShowLegend(false);

  34.     }
</code></pre><h5 id="6-更新图表updateChart"><a href="#6-更新图表updateChart" class="headerlink" title="(6)更新图表updateChart"></a>(6)更新图表updateChart</h5><p>这个方法主要实现了对图表中曲线图的更新绘制，同时检测手机摄像头感应的手指位置，如果手指位置不正确，则会提示“请用您的指尖盖住摄像头镜头”的信息来提示用户。动态的更新绘制曲线图来模拟用户心跳频率。</p>
<p>具体代码实现如下：</p>
<pre><code>      1. /**

  2.     * 更新图标信息

  3.    */

  4.    private void updateChart() {

  5.  

  6.      //设置好下一个需要增加的节点

  7.         if(flag==1)

  8.            addY=10;

  9.         else{

  10. //            addY=250;

  11.             flag=1;

  12.             if(gx&lt;200){

  13.                if(hua[20]&gt;1){

  14.                    Toast.makeText(MainActivity.this, &quot;请用您的指尖盖住摄像头镜头！&quot;, Toast.LENGTH_SHORT).show();

  15.                   hua[20]=0;}

  16.                hua[20]++;

  17.              return;}

  18.           else

  19.               hua[20]=10;

  20.            j=0;

  21.            

  22.         }

  23.        if(j&lt;20){

  24.          addY=hua[j];

  25.             j++;

  26.         }

  27.            

  28.         //移除数据集中旧的点集

  29.       mDataset.removeSeries(series);

  30.  

  31.      //判断当前点集中到底有多少点，因为屏幕总共只能容纳100个，所以当点数超过100时，长度永远是100

  32.        int length = series.getItemCount();

  33.        int bz=0;

  34.         //addX = length;

  35.       if (length &gt; 300) {

  36.            length = 300;

  37.           bz=1;

  38.       }

  39.        addX = length;

  40.       //将旧的点集中x和y的数值取出来放入backup中，并且将x的值加1，造成曲线向右平移的效果

  41.        for (int i = 0; i &lt; length; i++) {

  42.           xv[i] = (int) series.getX(i) -bz;

  43.          yv[i] = (int) series.getY(i);

  44.      }

  45.  

  46.       //点集先清空，为了做成新的点集而准备

  47.        series.clear();

  48.      mDataset.addSeries(series);

  49.      //将新产生的点首先加入到点集中，然后在循环体中将坐标变换后的一系列点都重新加入到点集中

  50.       //这里可以试验一下把顺序颠倒过来是什么效果，即先运行循环体，再添加新产生的点

  51.        series.add(addX, addY);

  52.      for (int k = 0; k &lt; length; k++) {

  53.           series.add(xv[k], yv[k]);

  54.        }

  55.        //在数据集中添加新的点集

  56.      //mDataset.addSeries(series);

  57.  

  58.         //视图更新，没有这一步，曲线不会呈现动态

  59.      //如果在非UI主线程中，需要调用postInvalidate()，具体参考api

  60.      chart.invalidate();

  61.  } //曲线
</code></pre><h5 id="7-相机预览回调方法previewCallback"><a href="#7-相机预览回调方法previewCallback" class="headerlink" title="(7)相机预览回调方法previewCallback"></a>(7)相机预览回调方法previewCallback</h5><p>这个方法中实现动态更新界面UI的功能，通过获取手机摄像头的参数来实时动态计算平均像素值、脉冲数，从而实时动态计算心率值。</p>
<p>具体代码实现如下：</p>
<pre><code>      1. /**

  2.     * 相机预览方法

  3.    * 这个方法中实现动态更新界面UI的功能，

  4.   * 通过获取手机摄像头的参数来实时动态计算平均像素值、脉冲数，从而实时动态计算心率值。

  5.     */

  6.    private static PreviewCallback previewCallback = new PreviewCallback() {

  7.        public void onPreviewFrame(byte[] data, Camera cam) {

  8.           if (data == null)

  9.                 throw new NullPointerException();

  10.            Camera.Size size = cam.getParameters().getPreviewSize();

  11.             if (size == null)

  12.                throw new NullPointerException();

  13.            if (!processing.compareAndSet(false, true))

  14.                return;

  15.            int width = size.width;

  16.            int height = size.height;

  17.          //图像处理

  18.             int imgAvg = ImageProcessing.decodeYUV420SPtoRedAvg(data.clone(),height,width);

  19.            gx=imgAvg;

  20.           text1.setText(&quot;平均像素值是&quot;+String.valueOf(imgAvg));

  21.             //像素平均值imgAvg,日志

  22.           //Log.i(TAG, &quot;imgAvg=&quot; + imgAvg);

  23.          if (imgAvg == 0 || imgAvg == 255) {

  24.              processing.set(false);

  25.                 return;

  26.            }

  27.            //计算平均值

  28.            int averageArrayAvg = 0;

  29.          int averageArrayCnt = 0;

  30.          for (int i = 0; i &lt; averageArray.length; i++) {

  31.              if (averageArray[i] &gt; 0) {

  32.                     averageArrayAvg += averageArray[i];

  33.                  averageArrayCnt++;

  34.               }

  35.            }

  36.            //计算平均值

  37.            int rollingAverage = (averageArrayCnt &gt; 0)?(averageArrayAvg/averageArrayCnt):0;

  38.           TYPE newType = currentType;

  39.          if (imgAvg &lt; rollingAverage) {

  40.              newType = TYPE.RED;

  41.              if (newType != currentType) {

  42.                  beats++;

  43.                     flag=0;

  44.                     text2.setText(&quot;脉冲数是&quot;+String.valueOf(beats));

  45.                    //Log.e(TAG, &quot;BEAT!! beats=&quot; + beats);

  46.                 }

  47.            } else if (imgAvg &gt; rollingAverage) {

  48.                 newType = TYPE.GREEN;

  49.            }

  50.  

  51.           if (averageIndex == averageArraySize)

  52.              averageIndex = 0;

  53.           averageArray[averageIndex] = imgAvg;

  54.             averageIndex++;

  55.  

  56.             // Transitioned from one state to another to the same

  57.          if (newType != currentType) {

  58.              currentType = newType;

  59.               //image.postInvalidate();

  60.          }

  61.            //获取系统结束时间（ms）

  62.             long endTime = System.currentTimeMillis();

  63.             double totalTimeInSecs = (endTime - startTime) / 1000d;

  64.           if (totalTimeInSecs &gt;= 2) {

  65.                double bps = (beats / totalTimeInSecs);

  66.                int dpm = (int) (bps * 60d);

  67.                if (dpm &lt; 30 || dpm &gt; 180||imgAvg&lt;200) {

  68.                   //获取系统开始时间（ms）

  69.                     startTime = System.currentTimeMillis();

  70.                  //beats心跳总数

  71.                    beats = 0;

  72.                  processing.set(false);

  73.                     return;

  74.                }

  75.                //Log.e(TAG, &quot;totalTimeInSecs=&quot; + totalTimeInSecs + &quot; beats=&quot;+ beats);

  76.                 if (beatsIndex == beatsArraySize)

  77.                  beatsIndex = 0;

  78.                 beatsArray[beatsIndex] = dpm;

  79.                beatsIndex++;

  80.                int beatsArrayAvg = 0;

  81.                int beatsArrayCnt = 0;

  82.                for (int i = 0; i &lt; beatsArray.length; i++) {

  83.                    if (beatsArray[i] &gt; 0) {

  84.                       beatsArrayAvg += beatsArray[i];

  85.                      beatsArrayCnt++;

  86.                     }

  87.                }

  88.                int beatsAvg = (beatsArrayAvg / beatsArrayCnt);

  89.                text.setText(&quot;您的的心率是&quot;+String.valueOf(beatsAvg)+&quot;  zhi:&quot;+String.valueOf(beatsArray.length)

  90.                      +&quot;    &quot;+String.valueOf(beatsIndex)+&quot;    &quot;+String.valueOf(beatsArrayAvg)+&quot;    &quot;+String.valueOf(beatsArrayCnt));

  91.                //获取系统时间（ms）

  92.               startTime = System.currentTimeMillis();

  93.              beats = 0;

  94.          }

  95.            processing.set(false);

  96.         }

  97.    };
</code></pre><h5 id="8-SurfaceHolder-Callback"><a href="#8-SurfaceHolder-Callback" class="headerlink" title="(8)SurfaceHolder.Callback"></a>(8)SurfaceHolder.Callback</h5><p>这个方法主要是相机摄像头，捕捉信息改变时调用。</p>
<p>具体代码实现如下：</p>
<pre><code>      1. /**

  2.     * 预览回调接口

  3.    */

  4.    private static SurfaceHolder.Callback surfaceCallback = new SurfaceHolder.Callback() {

  5.      //创建时调用

  6.         @Override

  7.      public void surfaceCreated(SurfaceHolder holder) {

  8.            try {

  9.               camera.setPreviewDisplay(previewHolder);

  10.                 camera.setPreviewCallback(previewCallback);

  11.          } catch (Throwable t) {

  12.                Log.e(&quot;PreviewDemo-surfaceCallback&quot;,&quot;Exception in setPreviewDisplay()&quot;, t);

  13.            }

  14.        }

  15.        //当预览改变的时候回调此方法

  16.        @Override

  17.         public void surfaceChanged(SurfaceHolder holder, int format, int width,int height) {

  18.           Camera.Parameters parameters = camera.getParameters();

  19.           parameters.setFlashMode(Camera.Parameters.FLASH_MODE_TORCH);

  20.             Camera.Size size = getSmallestPreviewSize(width, height, parameters);

  21.            if (size != null) {

  22.              parameters.setPreviewSize(size.width, size.height);

  23.              //               Log.d(TAG, &quot;Using width=&quot; + size.width + &quot; height=&quot; + size.height);

  24.           }

  25.            camera.setParameters(parameters);

  26.            camera.startPreview();

  27.       }

  28.        //销毁的时候调用

  29.      @Override

  30.         public void surfaceDestroyed(SurfaceHolder holder) {

  31.             // Ignore

  32.      }

  33.    };
</code></pre><h5 id="9-获取相机最小的预览尺寸方法getSmallestPreviewSize"><a href="#9-获取相机最小的预览尺寸方法getSmallestPreviewSize" class="headerlink" title="(9)获取相机最小的预览尺寸方法getSmallestPreviewSize"></a>(9)获取相机最小的预览尺寸方法getSmallestPreviewSize</h5><p>这个方法的功能是获取当前手机相机最小的预览尺寸。</p>
<p>具体代码实现如下:</p>
<pre><code>      1. /**

  2.      * 获取相机最小的预览尺寸

  3.   * @param width

  4.     * @param height

  5.    * @param parameters

  6.    * @return

  7.      */

  8.    private static Camera.Size getSmallestPreviewSize(int width, int height,

  9.           Camera.Parameters parameters) {

  10.       Camera.Size result = null;

  11.         for (Camera.Size size : parameters.getSupportedPreviewSizes()) {

  12.           if (size.width &lt;= width &amp;&amp; size.height &lt;= height) {

  13.              if (result == null) {

  14.                    result = size;

  15.               } else {

  16.                   int resultArea = result.width * result.height;

  17.                     int newArea = size.width * size.height;

  18.                    if (newArea &lt; resultArea)

  19.                       result = size;

  20.               }

  21.            }

  22.        }

  23.        return result;

  24.     }
</code></pre><h5 id="10-onCreate方法"><a href="#10-onCreate方法" class="headerlink" title="(10)onCreate方法"></a>(10)onCreate方法</h5><p>这个方法是Android原生自带的方法，通常在这个方法中我们会实现页面控件的初始化以及一些数据的初始化工作。我们这个项目中，主要是设置要显示的UI和调用initConfig方法来启动应用程序的配置，从而实现应用程序的顺利运行。</p>
<p>具体实现代码如下：</p>
<pre><code>      1. @Override

  2.   public void onCreate(Bundle savedInstanceState) {

  3.         super.onCreate(savedInstanceState);

  4.         setContentView(R.layout.activity_main);

  5.       initConfig();

  6.     }
</code></pre><h5 id="11-其他一些Android原生自带方法"><a href="#11-其他一些Android原生自带方法" class="headerlink" title="(11)其他一些Android原生自带方法"></a>(11)其他一些Android原生自带方法</h5><pre><code>      1. @Override

  2. public void onDestroy() {

  3.   //当结束程序时关掉Timer

  4.     timer.cancel();

  5.   super.onDestroy();

  6. };

  7. @Override

  8.  public void onConfigurationChanged(Configuration newConfig) {

  9.     super.onConfigurationChanged(newConfig);

  10. }

  11.  

  12. @Override

  13. public void onResume() {

  14.     super.onResume();

  15.  wakeLock.acquire();

  16.  camera = Camera.open();

  17.  startTime = System.currentTimeMillis();

  18. }

  19.  

  20. @Override

  21. public void onPause() {

  22.     super.onPause();

  23.   wakeLock.release();

  24.  camera.setPreviewCallback(null);

  25.   camera.stopPreview();

  26.    camera.release();

  27.    camera = null;

  28. }
</code></pre><h5 id="12-MainActivity完整代码"><a href="#12-MainActivity完整代码" class="headerlink" title="(12)MainActivity完整代码"></a>(12)MainActivity完整代码</h5><p>最后我还是给出MainActivity的完整代码吧，大家根据上面的分析仔细阅读几遍，便会体会这其中的奥妙了。嘿嘿，加油哦！</p>
<pre><code>      1. package com.lyz.xinlv.activity;

  2. import java.util.Timer;

  3. import java.util.TimerTask;

  4. import java.util.concurrent.atomic.AtomicBoolean;

  5.  

  6. import org.achartengine.ChartFactory;

  7. import org.achartengine.GraphicalView;

  8. import org.achartengine.chart.PointStyle;

  9. import org.achartengine.model.XYMultipleSeriesDataset;

  10. import org.achartengine.model.XYSeries;

  11. import org.achartengine.renderer.XYMultipleSeriesRenderer;

  12. import org.achartengine.renderer.XYSeriesRenderer;

  13.  

  14. import android.app.Activity;

  15. import android.content.Context;

  16. import android.content.res.Configuration;

  17. import android.graphics.Color;

  18. import android.graphics.Paint.Align;

  19. import android.hardware.Camera;

  20. import android.hardware.Camera.PreviewCallback;

  21. import android.os.Bundle;

  22. import android.os.Handler;

  23. import android.os.Message;

  24. import android.os.PowerManager;

  25. import android.os.PowerManager.WakeLock;

  26. import android.util.Log;

  27. import android.view.SurfaceHolder;

  28. import android.view.SurfaceView;

  29. import android.view.ViewGroup.LayoutParams;

  30. import android.widget.LinearLayout;

  31. import android.widget.TextView;

  32. import android.widget.Toast;

  33.  

  34. import com.lyz.monitor.utils.ImageProcessing;

  35.  

  36. /**

  37.  * 程序的主入口

  38.  * @author liuyazhuang

  39.  *

  40.  */

  41. public class MainActivity extends Activity {

  42.  //曲线

  43.   private Timer timer = new Timer();

  44.   //Timer任务，与Timer配套使用

  45.   private TimerTask task;

  46.    private static int gx;

  47.     private static int j;

  48.  

  49.     private static double flag=1;

  50.     private Handler handler;

  51.   private String title = &quot;pulse&quot;;

  52.   private XYSeries series;

  53.   private XYMultipleSeriesDataset mDataset;

  54.  private GraphicalView chart;

  55.   private XYMultipleSeriesRenderer renderer;

  56.     private Context context;

  57.   private int addX = -1;

  58.  double addY;

  59.   int[] xv = new int[300];

  60.  int[] yv = new int[300];

  61.  int[] hua=new int[]{9,10,11,12,13,14,13,12,11,10,9,8,7,6,7,8,9,10,11,10,10};

  62.  

  63.     //   private static final String TAG = &quot;HeartRateMonitor&quot;;

  64.     private static final AtomicBoolean processing = new AtomicBoolean(false);

  65.  //Android手机预览控件

  66.    private static SurfaceView preview = null;

  67.     //预览设置信息

  68.   private static SurfaceHolder previewHolder = null;

  69.     //Android手机相机句柄

  70.    private static Camera camera = null;

  71.   //private static View image = null;

  72.    private static TextView text = null;

  73.   private static TextView text1 = null;

  74.  private static TextView text2 = null;

  75.  private static WakeLock wakeLock = null;

  76.   private static int averageIndex = 0;

  77.  private static final int averageArraySize = 4;

  78.  private static final int[] averageArray = new int[averageArraySize];

  79.  

  80.    /**

  81.    * 类型枚举

  82.     * @author liuyazhuang

  83.     *

  84.      */

  85.   public static enum TYPE {

  86.      GREEN, RED

  87.   };

  88.   //设置默认类型

  89.   private static TYPE currentType = TYPE.GREEN;

  90.    //获取当前类型

  91.   public static TYPE getCurrent() {

  92.        return currentType;

  93.    }

  94.    //心跳下标值

  95.    private static int beatsIndex = 0;

  96.    //心跳数组的大小

  97.  private static final int beatsArraySize = 3;

  98.    //心跳数组

  99.     private static final int[] beatsArray = new int[beatsArraySize];

  100.    //心跳脉冲

  101.    private static double beats = 0;

  102.     //开始时间

  103.    private static long startTime = 0;

  104.  

  105.     @Override

  106.    public void onCreate(Bundle savedInstanceState) {

  107.       super.onCreate(savedInstanceState);

  108.       setContentView(R.layout.activity_main);

  109.         initConfig();

  110.   }

  111.  

  112.     /**

  113.   * 初始化配置

  114.   */

  115.  private void initConfig() {

  116.         //曲线

  117.      context = getApplicationContext();

  118.  

  119.        //这里获得main界面上的布局，下面会把图表画在这个布局里面

  120.       LinearLayout layout = (LinearLayout)findViewById(R.id.linearLayout1);

  121.  

  122.         //这个类用来放置曲线上的所有点，是一个点的集合，根据这些点画出曲线

  123.        series = new XYSeries(title);

  124.  

  125.       //创建一个数据集的实例，这个数据集将被用来创建图表

  126.        mDataset = new XYMultipleSeriesDataset();

  127.  

  128.       //将点集添加到这个数据集中

  129.        mDataset.addSeries(series);

  130.  

  131.       //以下都是曲线的样式和属性等等的设置，renderer相当于一个用来给图表做渲染的句柄

  132.      int color = Color.GREEN;

  133.      PointStyle style = PointStyle.CIRCLE;

  134.       renderer = buildRenderer(color, style, true);

  135.  

  136.       //设置好图表的样式

  137.        setChartSettings(renderer, &quot;X&quot;, &quot;Y&quot;, 0, 300, 4, 16, Color.WHITE, Color.WHITE);

  138.  

  139.      //生成图表

  140.        chart = ChartFactory.getLineChartView(context, mDataset, renderer);

  141.  

  142.       //将图表添加到布局中去

  143.      layout.addView(chart, new LayoutParams(LayoutParams.FILL_PARENT, LayoutParams.FILL_PARENT));

  144.  

  145.        //这里的Handler实例将配合下面的Timer实例，完成定时更新图表的功能

  146.       handler = new Handler() {

  147.             @Override

  148.            public void handleMessage(Message msg) {

  149.                //               刷新图表

  150.                 updateChart();

  151.              super.handleMessage(msg);

  152.             }

  153.       };

  154.  

  155.        task = new TimerTask() {

  156.          @Override

  157.            public void run() {

  158.                 Message message = new Message();

  159.              message.what = 1;

  160.              handler.sendMessage(message);

  161.           }

  162.       };

  163.  

  164.        timer.schedule(task, 1,20);           //曲线

  165.      //获取SurfaceView控件

  166.         preview = (SurfaceView) findViewById(R.id.preview);

  167.         previewHolder = preview.getHolder();

  168.        previewHolder.addCallback(surfaceCallback);

  169.         previewHolder.setType(SurfaceHolder.SURFACE_TYPE_PUSH_BUFFERS);

  170.         //       image = findViewById(R.id.image);

  171.        text = (TextView) findViewById(R.id.text);

  172.      text1 = (TextView) findViewById(R.id.text1);

  173.        text2 = (TextView) findViewById(R.id.text2);

  174.        PowerManager pm = (PowerManager) getSystemService(Context.POWER_SERVICE);

  175.       wakeLock = pm.newWakeLock(PowerManager.FULL_WAKE_LOCK, &quot;DoNotDimScreen&quot;);

  176.  }

  177.  

  178.     //   曲线

  179.   @Override

  180.    public void onDestroy() {

  181.       //当结束程序时关掉Timer

  182.       timer.cancel();

  183.         super.onDestroy();

  184.    };

  185.  

  186.    /**

  187.   * 创建图表

  188.    * @param color

  189.   * @param style

  190.   * @param fill

  191.    * @return

  192.    */

  193.  protected XYMultipleSeriesRenderer buildRenderer(int color, PointStyle style, boolean fill) {

  194.         XYMultipleSeriesRenderer renderer = new XYMultipleSeriesRenderer();

  195.  

  196.         //设置图表中曲线本身的样式，包括颜色、点的大小以及线的粗细等

  197.       XYSeriesRenderer r = new XYSeriesRenderer();

  198.      r.setColor(Color.RED);

  199. //        r.setPointStyle(null);

  200. //     r.setFillPoints(fill);

  201.       r.setLineWidth(1);

  202.         renderer.addSeriesRenderer(r);

  203.      return renderer;

  204.  }

  205.  

  206.     /**

  207.   * 设置图标的样式

  208.     * @param renderer

  209.    * @param xTitle：x标题

  210.      * @param yTitle：y标题

  211.      * @param xMin：x最小长度

  212.      * @param xMax：x最大长度

  213.      * @param yMin:y最小长度

  214.      * @param yMax：y最大长度

  215.      * @param axesColor：颜色

  216.    * @param labelsColor：标签

  217.      */

  218.  protected void setChartSettings(XYMultipleSeriesRenderer renderer, String xTitle, String yTitle,

  219.            double xMin, double xMax, double yMin, double yMax, int axesColor, int labelsColor) {

  220.       //有关对图表的渲染可参看api文档

  221.        renderer.setChartTitle(title);

  222.      renderer.setXTitle(xTitle);

  223.         renderer.setYTitle(yTitle);

  224.         renderer.setXAxisMin(xMin);

  225.         renderer.setXAxisMax(xMax);

  226.         renderer.setYAxisMin(yMin);

  227.         renderer.setYAxisMax(yMax);

  228.         renderer.setAxesColor(axesColor);

  229.       renderer.setLabelsColor(labelsColor);

  230.       renderer.setShowGrid(true);

  231.       renderer.setGridColor(Color.GREEN);

  232.         renderer.setXLabels(20);

  233.       renderer.setYLabels(10);

  234.       renderer.setXTitle(&quot;Time&quot;);

  235.        renderer.setYTitle(&quot;mmHg&quot;);

  236.        renderer.setYLabelsAlign(Align.RIGHT);

  237.      renderer.setPointSize((float) 3 );

  238.       renderer.setShowLegend(false);

  239.    }

  240.  

  241.     /**

  242.   * 更新图标信息

  243.      */

  244.  private void updateChart() {

  245.  

  246.      //设置好下一个需要增加的节点

  247.       if(flag==1)

  248.          addY=10;

  249.       else{

  250. //           addY=250;

  251.            flag=1;

  252.            if(gx&lt;200){

  253.               if(hua[20]&gt;1){

  254.                   Toast.makeText(MainActivity.this, &quot;请用您的指尖盖住摄像头镜头！&quot;, Toast.LENGTH_SHORT).show();

  255.                  hua[20]=0;}

  256.               hua[20]++;

  257.                 return;}

  258.          else

  259.              hua[20]=10;

  260.           j=0;

  261.           

  262.        }

  263.       if(j&lt;20){

  264.             addY=hua[j];

  265.            j++;

  266.        }

  267.           

  268.        //移除数据集中旧的点集

  269.      mDataset.removeSeries(series);

  270.  

  271.        //判断当前点集中到底有多少点，因为屏幕总共只能容纳100个，所以当点数超过100时，长度永远是100

  272.       int length = series.getItemCount();

  273.       int bz=0;

  274.        //addX = length;

  275.      if (length &gt; 300) {

  276.           length = 300;

  277.          bz=1;

  278.      }

  279.       addX = length;

  280.      //将旧的点集中x和y的数值取出来放入backup中，并且将x的值加1，造成曲线向右平移的效果

  281.       for (int i = 0; i &lt; length; i++) {

  282.          xv[i] = (int) series.getX(i) -bz;

  283.             yv[i] = (int) series.getY(i);

  284.         }

  285.  

  286.         //点集先清空，为了做成新的点集而准备

  287.       series.clear();

  288.         mDataset.addSeries(series);

  289.         //将新产生的点首先加入到点集中，然后在循环体中将坐标变换后的一系列点都重新加入到点集中

  290.      //这里可以试验一下把顺序颠倒过来是什么效果，即先运行循环体，再添加新产生的点

  291.       series.add(addX, addY);

  292.         for (int k = 0; k &lt; length; k++) {

  293.          series.add(xv[k], yv[k]);

  294.       }

  295.       //在数据集中添加新的点集

  296.         //mDataset.addSeries(series);

  297.  

  298.       //视图更新，没有这一步，曲线不会呈现动态

  299.         //如果在非UI主线程中，需要调用postInvalidate()，具体参考api

  300.         chart.invalidate();

  301.     } //曲线

  302.  

  303.  

  304.    @Override

  305.    public void onConfigurationChanged(Configuration newConfig) {

  306.       super.onConfigurationChanged(newConfig);

  307.  }

  308.  

  309.     @Override

  310.    public void onResume() {

  311.        super.onResume();

  312.         wakeLock.acquire();

  313.         camera = Camera.open();

  314.         startTime = System.currentTimeMillis();

  315.     }

  316.  

  317.     @Override

  318.    public void onPause() {

  319.         super.onPause();

  320.      wakeLock.release();

  321.         camera.setPreviewCallback(null);

  322.      camera.stopPreview();

  323.       camera.release();

  324.       camera = null;

  325.    }

  326.   

  327.    

  328.    /**

  329.   * 相机预览方法

  330.      * 这个方法中实现动态更新界面UI的功能，

  331.     * 通过获取手机摄像头的参数来实时动态计算平均像素值、脉冲数，从而实时动态计算心率值。

  332.   */

  333.  private static PreviewCallback previewCallback = new PreviewCallback() {

  334.      public void onPreviewFrame(byte[] data, Camera cam) {

  335.             if (data == null)

  336.               throw new NullPointerException();

  337.           Camera.Size size = cam.getParameters().getPreviewSize();

  338.            if (size == null)

  339.               throw new NullPointerException();

  340.           if (!processing.compareAndSet(false, true))

  341.               return;

  342.           int width = size.width;

  343.           int height = size.height;

  344.             //图像处理

  345.            int imgAvg = ImageProcessing.decodeYUV420SPtoRedAvg(data.clone(),height,width);

  346.           gx=imgAvg;

  347.          text1.setText(&quot;平均像素值是&quot;+String.valueOf(imgAvg));

  348.            //像素平均值imgAvg,日志

  349.          //Log.i(TAG, &quot;imgAvg=&quot; + imgAvg);

  350.             if (imgAvg == 0 || imgAvg == 255) {

  351.                 processing.set(false);

  352.                return;

  353.           }

  354.           //计算平均值

  355.           int averageArrayAvg = 0;

  356.             int averageArrayCnt = 0;

  357.             for (int i = 0; i &lt; averageArray.length; i++) {

  358.                 if (averageArray[i] &gt; 0) {

  359.                    averageArrayAvg += averageArray[i];

  360.                     averageArrayCnt++;

  361.              }

  362.           }

  363.           //计算平均值

  364.           int rollingAverage = (averageArrayCnt &gt; 0)?(averageArrayAvg/averageArrayCnt):0;

  365.          TYPE newType = currentType;

  366.             if (imgAvg &lt; rollingAverage) {

  367.                 newType = TYPE.RED;

  368.                 if (newType != currentType) {

  369.                     beats++;

  370.                    flag=0;

  371.                    text2.setText(&quot;脉冲数是&quot;+String.valueOf(beats));

  372.                   //Log.e(TAG, &quot;BEAT!! beats=&quot; + beats);

  373.                }

  374.           } else if (imgAvg &gt; rollingAverage) {

  375.                newType = TYPE.GREEN;

  376.           }

  377.  

  378.             if (averageIndex == averageArraySize)

  379.                 averageIndex = 0;

  380.          averageArray[averageIndex] = imgAvg;

  381.            averageIndex++;

  382.  

  383.           // Transitioned from one state to another to the same

  384.             if (newType != currentType) {

  385.                 currentType = newType;

  386.              //image.postInvalidate();

  387.             }

  388.           //获取系统结束时间（ms）

  389.            long endTime = System.currentTimeMillis();

  390.            double totalTimeInSecs = (endTime - startTime) / 1000d;

  391.          if (totalTimeInSecs &gt;= 2) {

  392.               double bps = (beats / totalTimeInSecs);

  393.               int dpm = (int) (bps * 60d);

  394.               if (dpm &lt; 30 || dpm &gt; 180||imgAvg&lt;200) {

  395.                  //获取系统开始时间（ms）

  396.                    startTime = System.currentTimeMillis();

  397.                     //beats心跳总数

  398.                   beats = 0;

  399.                     processing.set(false);

  400.                    return;

  401.               }

  402.               //Log.e(TAG, &quot;totalTimeInSecs=&quot; + totalTimeInSecs + &quot; beats=&quot;+ beats);

  403.                if (beatsIndex == beatsArraySize)

  404.                     beatsIndex = 0;

  405.                beatsArray[beatsIndex] = dpm;

  406.               beatsIndex++;

  407.               int beatsArrayAvg = 0;

  408.               int beatsArrayCnt = 0;

  409.               for (int i = 0; i &lt; beatsArray.length; i++) {

  410.                   if (beatsArray[i] &gt; 0) {

  411.                      beatsArrayAvg += beatsArray[i];

  412.                         beatsArrayCnt++;

  413.                    }

  414.               }

  415.               int beatsAvg = (beatsArrayAvg / beatsArrayCnt);

  416.               text.setText(&quot;您的的心率是&quot;+String.valueOf(beatsAvg)+&quot;  zhi:&quot;+String.valueOf(beatsArray.length)

  417.                         +&quot;    &quot;+String.valueOf(beatsIndex)+&quot;    &quot;+String.valueOf(beatsArrayAvg)+&quot;    &quot;+String.valueOf(beatsArrayCnt));

  418.               //获取系统时间（ms）

  419.              startTime = System.currentTimeMillis();

  420.                 beats = 0;

  421.             }

  422.           processing.set(false);

  423.        }

  424.   };

  425.  

  426.    /**

  427.   * 预览回调接口

  428.      */

  429.  private static SurfaceHolder.Callback surfaceCallback = new SurfaceHolder.Callback() {

  430.        //创建时调用

  431.       @Override

  432.        public void surfaceCreated(SurfaceHolder holder) {

  433.          try {

  434.                 camera.setPreviewDisplay(previewHolder);

  435.                camera.setPreviewCallback(previewCallback);

  436.             } catch (Throwable t) {

  437.               Log.e(&quot;PreviewDemo-surfaceCallback&quot;,&quot;Exception in setPreviewDisplay()&quot;, t);

  438.           }

  439.       }

  440.       //当预览改变的时候回调此方法

  441.       @Override

  442.        public void surfaceChanged(SurfaceHolder holder, int format, int width,int height) {

  443.          Camera.Parameters parameters = camera.getParameters();

  444.          parameters.setFlashMode(Camera.Parameters.FLASH_MODE_TORCH);

  445.            Camera.Size size = getSmallestPreviewSize(width, height, parameters);

  446.           if (size != null) {

  447.                 parameters.setPreviewSize(size.width, size.height);

  448.                 //               Log.d(TAG, &quot;Using width=&quot; + size.width + &quot; height=&quot; + size.height);

  449.          }

  450.           camera.setParameters(parameters);

  451.           camera.startPreview();

  452.      }

  453.       //销毁的时候调用

  454.         @Override

  455.        public void surfaceDestroyed(SurfaceHolder holder) {

  456.            // Ignore

  457.         }

  458.   };

  459.  

  460.    /**

  461.   * 获取相机最小的预览尺寸

  462.     * @param width

  463.   * @param height

  464.      * @param parameters

  465.      * @return

  466.    */

  467.  private static Camera.Size getSmallestPreviewSize(int width, int height,

  468.             Camera.Parameters parameters) {

  469.      Camera.Size result = null;

  470.        for (Camera.Size size : parameters.getSupportedPreviewSizes()) {

  471.          if (size.width &lt;= width &amp;&amp; size.height &lt;= height) {

  472.                 if (result == null) {

  473.                   result = size;

  474.              } else {

  475.                  int resultArea = result.width * result.height;

  476.                    int newArea = size.width * size.height;

  477.                   if (newArea &lt; resultArea)

  478.                      result = size;

  479.              }

  480.           }

  481.       }

  482.       return result;

  483.    }

  484. }
</code></pre><h4 id="3、UI布局"><a href="#3、UI布局" class="headerlink" title="3、UI布局"></a>3、UI布局</h4><p>这里就不多说了，对于UI布局的实现，相信大家看了源码都懂得。</p>
<p>具体代码实现如下：</p>
<pre><code>      1. &lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;

  2.     xmlns:tools=&quot;http://schemas.android.com/tools&quot;

  3.     android:layout_width=&quot;match_parent&quot;

  4.     android:layout_height=&quot;match_parent&quot;

  5.     android:orientation=&quot;vertical&quot; &gt;

  6.  

  7.     &lt;SurfaceView

  8.         android:id=&quot;@+id/preview&quot;

  9.         android:layout_width=&quot;fill_parent&quot;

  10.         android:layout_height=&quot;200dp&quot;

  11.         android:layout_marginLeft=&quot;50dip&quot;

  12.         android:layout_marginRight=&quot;50dip&quot; /&gt;

  13.  

  14.     &lt;LinearLayout

  15.         android:id=&quot;@+id/linearLayout1&quot;

  16.         android:layout_width=&quot;match_parent&quot;

  17.         android:layout_height=&quot;200dp&quot;

  18.         android:orientation=&quot;vertical&quot; &gt;

  19.     &lt;/LinearLayout&gt;

  20.  

  21.     &lt;TextView

  22.         android:id=&quot;@+id/text&quot;

  23.         android:layout_width=&quot;wrap_content&quot;

  24.         android:layout_height=&quot;wrap_content&quot;

  25.         android:layout_marginLeft=&quot;50dip&quot;

  26.         android:layout_weight=&quot;1&quot;

  27.         android:text=&quot;@string/show&quot; &gt;

  28.     &lt;/TextView&gt;

  29.  

  30.     &lt;TextView

  31.         android:id=&quot;@+id/text1&quot;

  32.         android:layout_width=&quot;wrap_content&quot;

  33.         android:layout_height=&quot;wrap_content&quot;

  34.         android:layout_marginLeft=&quot;50dip&quot;

  35.         android:layout_weight=&quot;1&quot;

  36.         android:text=&quot;@string/show&quot; &gt;

  37.     &lt;/TextView&gt;

  38.  

  39.     &lt;TextView

  40.         android:id=&quot;@+id/text2&quot;

  41.         android:layout_width=&quot;wrap_content&quot;

  42.         android:layout_height=&quot;wrap_content&quot;

  43.         android:layout_marginLeft=&quot;50dip&quot;

  44.         android:layout_weight=&quot;1&quot;

  45.         android:text=&quot;@string/show&quot; &gt;

  46.     &lt;/TextView&gt;

  47.  

  48. &lt;/LinearLayout&gt;
</code></pre><h4 id="4、strings-xml"><a href="#4、strings-xml" class="headerlink" title="4、strings.xml"></a>4、strings.xml</h4><pre><code>      1. &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

  2. &lt;resources&gt;

  3.  

  4.     &lt;string name=&quot;app_name&quot;&gt;心率检测&lt;/string&gt;

  5.     &lt;string name=&quot;action_settings&quot;&gt;Settings&lt;/string&gt;

  6.     &lt;string name=&quot;hello_world&quot;&gt;Hello world!&lt;/string&gt;

  7.     &lt;string name=&quot;show&quot;&gt;显示&lt;/string&gt;

  8. &lt;/resources&gt;
</code></pre><h4 id="5、授权AndroidManifest-xml"><a href="#5、授权AndroidManifest-xml" class="headerlink" title="5、授权AndroidManifest.xml"></a>5、授权AndroidManifest.xml</h4><p>最后，我把授权文件贴出来吧。</p>
<p>具体代码实现如下：</p>
<pre><code>      1. &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

  2. &lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;

  3.     package=&quot;com.lyz.xinlv.activity&quot;

  4.     android:versionCode=&quot;1&quot;

  5.     android:versionName=&quot;1.0&quot; &gt;

  6.  

  7.     &lt;uses-sdk

  8.         android:minSdkVersion=&quot;15&quot;

  9.         android:targetSdkVersion=&quot;15&quot; /&gt;

  10.     &lt;uses-permission android:name=&quot;android.permission.WAKE_LOCK&quot; /&gt;

  11.     &lt;uses-permission android:name=&quot;android.permission.CAMERA&quot; /&gt;

  12.     &lt;uses-feature android:name=&quot;android.hardware.camera&quot; /&gt;

  13.     &lt;uses-feature android:name=&quot;android.hardware.camera.autofocus&quot; /&gt;

  14.  

  15.     &lt;application

  16.         android:allowBackup=&quot;true&quot;

  17.         android:icon=&quot;@drawable/ic_launcher&quot;

  18.         android:label=&quot;@string/app_name&quot;

  19.         android:theme=&quot;@style/AppTheme&quot; &gt;

  20.         &lt;activity

  21.             android:name=&quot;com.lyz.xinlv.activity.MainActivity&quot;

  22.             android:label=&quot;@string/app_name&quot; &gt;

  23.             &lt;intent-filter&gt;

  24.                 &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;

  25.  

  26.                 &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;

  27.             &lt;/intent-filter&gt;

  28.         &lt;/activity&gt;

  29.     &lt;/application&gt;

  30.  

  31. &lt;/manifest&gt;
</code></pre><p>至此，这个应用开发完成，亲们，是不是比想象的简单呢？  </p>
<h3 id="三、运行效果"><a href="#三、运行效果" class="headerlink" title="三、运行效果"></a>三、运行效果</h3><p><img src="https://img-
blog.csdn.net/20150731150731132?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p><img src="https://img-
blog.csdn.net/20150731150909022?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="">  </p>
<p><img src="https://img-
blog.csdn.net/20150731151115964?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p><img src="https://img-
blog.csdn.net/20150731151054385?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p><img src="https://img-
blog.csdn.net/20150731151739678?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<h3 id="四、温馨提示"><a href="#四、温馨提示" class="headerlink" title="四、温馨提示"></a>四、温馨提示</h3><p>本实例中，为了方面，我把一些文字直接写在了布局文件中和相关的类中，大家在真实的项目中要把这些文字写在string.xml文件中，在外部引用这些资源，切记，这是作为一个Android程序员最基本的开发常识和规范，我在这里只是为了方便直接写在了类和布局文件中。</p>
<p>大家可以到链接 <a href="http://download.csdn.net/detail/l1028386804/8949597" target="_blank" rel="noopener"> http://download.csdn.net/detail/l1028386804/8949597
</a> 获取完整模拟实现检测心率变化的应用源代码  </p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>如果觉得有帮助就请我喝杯咖啡鼓励我继续创作吧^_^</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="DmrfCoder 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="DmrfCoder 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/android/" rel="tag"><i class="fa fa-tag"></i>

 android</a>
          
            <a href="/tags/心率检测/" rel="tag"><i class="fa fa-tag"></i>

 心率检测</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/07/28/Gson自定义序列化与反序列化/" rel="next" title="Gson自定义序列化与反序列化">
                <i class="fa fa-chevron-left"></i> Gson自定义序列化与反序列化
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/07/28/Android studio Session 'app': Error Installing APK解决方法/" rel="prev" title="Android studio Session 'app' Error Installing APK解决方法">
                Android studio Session 'app' Error Installing APK解决方法 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "1",
        "bdMiniList": false,
        "bdPic": ""
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      },
      "slide": {
        "bdImg": "5",
        "bdPos": "left",
        "bdTop": "100"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80MTQ5Mi8xODAzOQ=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/photo.png" alt="DmrfCoder">
            
              <p class="site-author-name" itemprop="name">DmrfCoder</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">137</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">90</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/DmrfCoder" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:xuefanggang97@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/qq_36982160" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-globe"></i>CSDN</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://plus.google.com/114058949111753522144" target="_blank" title="Google">
                      
                        <i class="fa fa-fw fa-google"></i>Google</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Android之——模拟实现检测心率变化的应用实例"><span class="nav-number">1.</span> <span class="nav-text">Android之——模拟实现检测心率变化的应用实例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一、原理"><span class="nav-number">1.0.1.</span> <span class="nav-text">一、原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、实现"><span class="nav-number">1.0.2.</span> <span class="nav-text">二、实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1、创建图像处理类ImageProcessing"><span class="nav-number">1.0.2.1.</span> <span class="nav-text">1、创建图像处理类ImageProcessing</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2、MainActivity实现"><span class="nav-number">1.0.2.2.</span> <span class="nav-text">2、MainActivity实现</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-程序中用到的属性"><span class="nav-number">1.0.2.2.1.</span> <span class="nav-text">(1)程序中用到的属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-定义枚举类型来标识当前颜色"><span class="nav-number">1.0.2.2.2.</span> <span class="nav-text">(2)定义枚举类型来标识当前颜色</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-初始化配置方法initConfig"><span class="nav-number">1.0.2.2.3.</span> <span class="nav-text">(3)初始化配置方法initConfig</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-创建图表的方法buildRenderer"><span class="nav-number">1.0.2.2.4.</span> <span class="nav-text">(4)创建图表的方法buildRenderer</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-设置图表的样式方法setChartSettings"><span class="nav-number">1.0.2.2.5.</span> <span class="nav-text">(5)设置图表的样式方法setChartSettings</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-更新图表updateChart"><span class="nav-number">1.0.2.2.6.</span> <span class="nav-text">(6)更新图表updateChart</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-相机预览回调方法previewCallback"><span class="nav-number">1.0.2.2.7.</span> <span class="nav-text">(7)相机预览回调方法previewCallback</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-SurfaceHolder-Callback"><span class="nav-number">1.0.2.2.8.</span> <span class="nav-text">(8)SurfaceHolder.Callback</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-获取相机最小的预览尺寸方法getSmallestPreviewSize"><span class="nav-number">1.0.2.2.9.</span> <span class="nav-text">(9)获取相机最小的预览尺寸方法getSmallestPreviewSize</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#10-onCreate方法"><span class="nav-number">1.0.2.2.10.</span> <span class="nav-text">(10)onCreate方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#11-其他一些Android原生自带方法"><span class="nav-number">1.0.2.2.11.</span> <span class="nav-text">(11)其他一些Android原生自带方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#12-MainActivity完整代码"><span class="nav-number">1.0.2.2.12.</span> <span class="nav-text">(12)MainActivity完整代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3、UI布局"><span class="nav-number">1.0.2.3.</span> <span class="nav-text">3、UI布局</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4、strings-xml"><span class="nav-number">1.0.2.4.</span> <span class="nav-text">4、strings.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5、授权AndroidManifest-xml"><span class="nav-number">1.0.2.5.</span> <span class="nav-text">5、授权AndroidManifest.xml</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、运行效果"><span class="nav-number">1.0.3.</span> <span class="nav-text">三、运行效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四、温馨提示"><span class="nav-number">1.0.4.</span> <span class="nav-text">四、温馨提示</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">DmrfCoder</span>

  
</div>


 <!--  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>
-->



<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共212.5k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  





  
  



  
  





  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/canvas_sphere.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("JPtogBfdkQuninsLWN80PLoY-gzGzoHsz", "0aMQbm6Xk3vkvN16T1yCsmTh");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
